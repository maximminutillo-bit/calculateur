<!doctype html>
<html lang="fr" class="h-full bg-gray-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Supercalculateur Freebet</title>
  <meta name="description" content="Calculateur Freebet / Bonus / Couverture / EV ‚Äì Mobile-first" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéØ</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
  // Helpers
  const fmt = (n) => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(n || 0);
  const show = (el) => el.classList.remove('hidden');
  const hide = (el) => el.classList.add('hidden');

  // Copy buttons (generic)
  document.addEventListener('click', async (e) => {
    const btn = e.target.closest('.copy-btn');
    if (!btn) return;
    const id = btn.getAttribute('data-copy-target');
    const val = document.getElementById(id)?.textContent || '';
    try {
      await navigator.clipboard.writeText(val.replace(/[^0-9,.-]/g, '').replace(',', '.'));
      const old = btn.textContent; btn.textContent = 'Copi√© !'; setTimeout(()=> btn.textContent=old, 1200);
    } catch {}
  });

  // Conversion LAY OrbitX (JS port de ta fonction Python)
  const conversionLayOrbitx = (back_odds, lay_odds, freebet_amount, commission_percent = 3) => {
    const commission = commission_percent / 100;
    const lay_stake = (freebet_amount * (back_odds - 1)) / (lay_odds - commission);
    const liability = lay_stake * (lay_odds - 1);
    const gain_back = (back_odds - 1) * freebet_amount - liability;
    const gain_lay = lay_stake * (1 - commission);
    const net_result = Math.min(gain_back, gain_lay);
    const conversion = (net_result / freebet_amount) * 100;
    return { lay_stake, liability, gain_back, gain_lay, net_result, conversion };
  }

  const updateIndicator = (conv) => {
    const box = document.getElementById('lay-indicator');
    box.textContent = conv >= 80 ? '‚úÖ Conversion excellente (‚â• 80%)' : '‚ö†Ô∏è Conversion insuffisante (< 80%)';
    box.className = 'mt-3 rounded-xl px-3 py-2 text-sm font-medium ' + (conv >= 80 ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-amber-100 text-amber-800 border border-amber-300');
    show(box);
  }

  const layCalc = () => {
    const F = parseFloat(document.getElementById('lay-freebet').value.replace(',', '.')) || 0;
    const cB = parseFloat(document.getElementById('lay-back').value.replace(',', '.')) || 0;
    const cL = parseFloat(document.getElementById('lay-lay').value.replace(',', '.')) || 0;
    const comm = parseFloat(document.getElementById('lay-comm').value.replace(',', '.'));
    if (F > 0 && cB > 1 && cL > 1 && comm >= 0 && (cL - (comm/100)) > 0) {
      const r = conversionLayOrbitx(cB, cL, F, isNaN(comm) ? 3 : comm);
      document.getElementById('lay-stake').textContent = fmt(r.lay_stake);
      document.getElementById('lay-liability').textContent = fmt(r.liability);
      document.getElementById('lay-gain-back').textContent = fmt(r.gain_back);
      document.getElementById('lay-gain-lay').textContent = fmt(r.gain_lay);
      document.getElementById('lay-net').textContent = fmt(r.net_result);
      const conv = Math.round(r.conversion * 100) / 100;
      document.getElementById('lay-conv').textContent = conv.toFixed(2) + '%';
      updateIndicator(conv);
      show(document.getElementById('lay-result'));
      localStorage.setItem('sc-lay', JSON.stringify({F, cB, cL, comm}));
    }
  }

  // Listeners
  document.getElementById('lay-calcul').addEventListener('click', layCalc);
  document.getElementById('lay-reset').addEventListener('click', () => {
    ['lay-freebet','lay-back','lay-lay','lay-comm'].forEach(id => document.getElementById(id).value = id==='lay-comm' ? '3' : '');
    hide(document.getElementById('lay-result'));
    hide(document.getElementById('lay-indicator'));
  });

  // Restore
  try { const s = JSON.parse(localStorage.getItem('sc-lay') || '{}');
    if (s.F) document.getElementById('lay-freebet').value = s.F;
    if (s.cB) document.getElementById('lay-back').value = s.cB;
    if (s.cL) document.getElementById('lay-lay').value = s.cL;
    document.getElementById('lay-comm').value = (s.comm !== undefined) ? s.comm : '3';
  } catch {}
</script>
</body>
</html>
