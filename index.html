<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Convertisseur LAY OrbitX</title>
  <meta name="description" content="Calcul LAY OrbitX avec commission – freebet conversion" />
  <style>
    :root { color-scheme: light dark; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#f6f7fb; color:#0f172a; }
    .wrap { max-width: 640px; margin: 0 auto; padding: 16px; }
    .card { background:#fff; border-radius: 16px; padding:16px; box-shadow:0 6px 20px rgba(0,0,0,.06); border:1px solid #e6e8ef; }
    h1 { margin: 6px 0 2px; font-size: 22px; }
    p.sub { margin:0 0 12px; color:#475569; font-size: 13px; }
    label { display:block; font-size: 14px; margin:10px 0 6px; }
    input { width:100%; font: inherit; padding:10px 12px; border-radius:12px; border:1px solid #cbd5e1; outline:none; }
    input:focus { border-color:#0f172a; box-shadow: 0 0 0 3px rgba(15,23,42,.08); }
    .row { display:flex; gap:10px; }
    .btn { cursor:pointer; border:1px solid #0f172a; background:#0f172a; color:#fff; padding:10px 14px; border-radius:12px; font-weight:600; }
    .btn.ghost { background:#fff; color:#0f172a; }
    .muted { color:#475569; font-size:12px; }
    .result { border:1px solid #fde68a; background:#fffbeb; border-radius:12px; padding:12px; margin-top:12px; }
    .grid { display:grid; grid-template-columns: 1fr auto; row-gap:6px; }
    .pill { display:none; margin-top:10px; padding:8px 10px; border-radius:10px; font-weight:600; font-size:13px; }
    .ok { background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; }
    .warn { background:#fff7ed; color:#9a3412; border:1px solid #fed7aa; }
    @media (prefers-color-scheme: dark) {
      body { background:#0b1220; color:#e5e7eb; }
      .card { background:#0f172a; border-color:#1f2937; }
      input { background:#0b1220; color:#e5e7eb; border-color:#334155; }
      .btn.ghost { background:#0f172a; color:#e5e7eb; border-color:#334155; }
      .result { background:#1f2937; border-color:#7c3aed; }
      .muted { color:#94a3b8; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Convertisseur LAY OrbitX</h1>
      <p class="sub">Calcule la mise LAY optimale en tenant compte de la <strong>commission</strong> (par défaut 3%).</p>

      <label>Montant du freebet (€)
        <input id="lay-freebet" type="number" inputmode="decimal" step="0.01" min="0" placeholder="Ex: 25" />
      </label>
      <label>Cote BACK (book FR)
        <input id="lay-back" type="number" inputmode="decimal" step="0.01" min="1.01" placeholder="Ex: 2.20" />
      </label>
      <label>Cote LAY (OrbitX)
        <input id="lay-lay" type="number" inputmode="decimal" step="0.01" min="1.01" placeholder="Ex: 1.70" />
      </label>
      <label>Commission OrbitX (%)
        <input id="lay-comm" type="number" inputmode="decimal" step="0.1" min="0" max="100" value="3" />
      </label>

      <div class="row" style="margin-top:10px">
        <button id="lay-calcul" class="btn" aria-label="Calculer">Calculer</button>
        <button id="lay-reset" class="btn ghost" aria-label="Réinitialiser">Réinitialiser</button>
      </div>

      <div id="lay-result" class="result" style="display:none">
        <div class="grid">
          <div>Mise LAY (OrbitX)</div><div id="lay-stake"><strong>€0.00</strong></div>
          <div>Liability</div><div id="lay-liability"><strong>€0.00</strong></div>
          <div>Gain si BACK gagne</div><div id="lay-gain-back"><strong>€0.00</strong></div>
          <div>Gain si LAY gagne</div><div id="lay-gain-lay"><strong>€0.00</strong></div>
          <div>Net (le + faible)</div><div id="lay-net"><strong>€0.00</strong></div>
          <div>Taux de conversion</div><div id="lay-conv"><strong>0%</strong></div>
        </div>
        <div id="lay-indicator" class="pill"></div>
        <p class="muted" style="margin-top:8px">Formules : mise_LAY = F × (cBACK − 1) / (cLAY − commission) ; liability = mise_LAY × (cLAY − 1) ; net = min(gain_back, gain_lay).</p>
      </div>
    </div>
  </div>

  <script>
    const fmt = (n) => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(n || 0);
    const show = (el) => el.style.display = '';
    const hide = (el) => el.style.display = 'none';

    const conversionLayOrbitx = (back_odds, lay_odds, freebet_amount, commission_percent = 3) => {
      const commission = commission_percent / 100;
      const lay_stake = (freebet_amount * (back_odds - 1)) / (lay_odds - commission);
      const liability = lay_stake * (lay_odds - 1);
      const gain_back = (back_odds - 1) * freebet_amount - liability;
      const gain_lay = lay_stake * (1 - commission);
      const net_result = Math.min(gain_back, gain_lay);
      const conversion = (net_result / freebet_amount) * 100;
      return { lay_stake, liability, gain_back, gain_lay, net_result, conversion };
    }

    const updateIndicator = (conv) => {
      const box = document.getElementById('lay-indicator');
      box.textContent = conv >= 80 ? '✅ Conversion excellente (≥ 80%)' : '⚠️ Conversion insuffisante (< 80%)';
      box.className = 'pill ' + (conv >= 80 ? 'ok' : 'warn');
      show(box);
    }

    const layCalc = () => {
      const F = parseFloat(document.getElementById('lay-freebet').value.replace(',', '.')) || 0;
      const cB = parseFloat(document.getElementById('lay-back').value.replace(',', '.')) || 0;
      const cL = parseFloat(document.getElementById('lay-lay').value.replace(',', '.')) || 0;
      const comm = parseFloat(document.getElementById('lay-comm').value.replace(',', '.'));
      if (F > 0 && cB > 1 && cL > 1 && comm >= 0 && (cL - (comm/100)) > 0) {
        const r = conversionLayOrbitx(cB, cL, F, isNaN(comm) ? 3 : comm);
        document.getElementById('lay-stake').innerHTML = '<strong>' + fmt(r.lay_stake) + '</strong>';
        document.getElementById('lay-liability').innerHTML = '<strong>' + fmt(r.liability) + '</strong>';
        document.getElementById('lay-gain-back').innerHTML = '<strong>' + fmt(r.gain_back) + '</strong>';
        document.getElementById('lay-gain-lay').innerHTML = '<strong>' + fmt(r.gain_lay) + '</strong>';
        document.getElementById('lay-net').innerHTML = '<strong>' + fmt(r.net_result) + '</strong>';
        const conv = Math.round(r.conversion * 100) / 100;
        document.getElementById('lay-conv').innerHTML = '<strong>' + conv.toFixed(2) + '%</strong>';
        updateIndicator(conv);
        show(document.getElementById('lay-result'));
        localStorage.setItem('sc-lay', JSON.stringify({F, cB, cL, comm}));
      }
    }

    document.getElementById('lay-calcul').addEventListener('click', layCalc);
    document.getElementById('lay-reset').addEventListener('click', () => {
      ['lay-freebet','lay-back','lay-lay','lay-comm'].forEach(id => document.getElementById(id).value = id==='lay-comm' ? '3' : '');
      hide(document.getElementById('lay-result'));
      hide(document.getElementById('lay-indicator'));
    });

    try { const s = JSON.parse(localStorage.getItem('sc-lay') || '{}');
      if (s.F) document.getElementById('lay-freebet').value = s.F;
      if (s.cB) document.getElementById('lay-back').value = s.cB;
      if (s.cL) document.getElementById('lay-lay').value = s.cL;
      document.getElementById('lay-comm').value = (s.comm !== undefined) ? s.comm : '3';
    } catch {}
  </script>
</body>
</html>
